<!-- Standard link tag-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/thomas-lowry/figma-plugin-ds/dist/figma-plugin-ds.css"> -->

  <title>figma-plugin-ds</title>

  <style>
    
    :root {
    --font-family: 'Inter', sans-serif;
    --background-color-body: #1C1C1E;
    --background-color-container: #2C2C2E;
    --background-color-input-section: #3A3A3C;
    --background-color-prompt: #2C2C2E;
    --background-primary: #5e6ae9;
    --background-primary-opacity: rgba(94, 106, 233, 0.06);
    --color-white: #FFFFFF;
    --padding: 1.25rem; /* 20px */
    --border-radius: 0.5rem; /* 8px */
    --font-size-h1: 1.5rem; /* 24px */
    --padding-input: 0.625rem; /* 10px */
    --padding-small: 0.4rem; 
    --font-size-buttons: 1rem; /* 16px */
    --margin: 1em;
    --input-hover-color: #444446;
    --button-hover-color: #535fe3;
    --tab-active-color: #6E5EE9;
    --tab-inactive-color: rgba(32, 31, 31, 0.2);
    --tab-text-color: #FFFFFF;
    }

    /* BODY STYLES*/
    body {
      font-family: var(--font-family);
      background-color: var(--background-color-body);
      color: var(--color-white);
      display: flex;
      justify-content: center;
      align-items: center;
    }

    /* MAIN CONTAINER STYLES*/
    .container {
      background-color: var(--background-color-container);
      padding: var(--padding);
      border-radius: var(--border-radius);
      text-align: center;
      width: 90%;
      min-height: 80%;
      display: flex;
      gap: var(--padding);
      flex-direction: column;
      justify-content: center;
    }

    
    /* HORIZONTAL CONTENT*/
    .sections-horizontal{
      background-color: var(--background-color-input-section);
      padding: var(--padding);
      border-radius: var(--border-radius);
      /* width: 100%; */
      height: 100%;
      display: flex;
      gap: var(--padding);
      flex-direction: row;
      justify-content: center;
      align-items: center;
    }

    /* VERTICAL CONTENT*/
    .sections-vertical{
      background-color: var(--background-color-input-section);
      padding: var(--padding);
      border-radius: var(--border-radius);
      /* width: 100%; */
      height: 100%;
      display: flex;
      gap: var(--padding);
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    /* H1*/
    h1 {
      font-size: var(--font-size-h1);
      margin-bottom: var(--padding);
    }

    /* INPUT FIELDS SELECTS STYLES*/
    #prompt,#font-size,#font-weight,#font-family, #color, #fontColor{
      width: 80%;
      padding: calc(var(--padding-input) * 2); /* Increase the height of the input field */
      border: none;
      border-radius: var(--border-radius);
      background-color: var(--background-color-prompt);
      color: var(--color-white);
    }

    /* FONT SIZE STYLES*/
    #font-size {
      width: 20%;
      padding: var(--padding-small);
    }

    /* FONT WEIGHT STYLES*/
    #font-weight {
      width: 30%;
      padding: var(--padding-small);
    }

    /* BG COLOUR STYLES*/
    #color {
      width: 20%;
      padding: var(--padding-small);
      height: 50px;
    }

    /* FONT COLOUR STYLES*/
    #fontColor {
      width: 20%;
      padding: var(--padding-small);
      height: 50px;
    }

    /* INPUT FIELDS SELECTED STYLES*/
    #prompt:focus {
      background-color: var(--input-hover-color);
      outline: none;
    }

    /* GENERATE BUTTON STYLES*/
    .generate-button {
      background-color: var(--background-primary);
      border: none;
      color: var(--color-white);
      padding: var(--padding);
      border-radius: var(--border-radius);
      align-items: stretch;
      cursor: pointer;
      width: 20%;
    }

    /* GENERATE BUTTON HOVER STYLE*/
    .generate-button:hover {
      background-color: var(--button-hover-color);
    }

    /* TABS STYLES*/
    .tabs {
      margin-top: var(--padding);
      width: 100%;
      display: flex;
      justify-content: space-around;
      border-bottom: 2px solid var(--background-color-input-section) 0;
    }

    /* TABS FONT STYLE*/
    #tab-font {
      font-size: var(--font-size-buttons);
    }

    /* TABS RADIO STYLES*/
    .tabs input[type="radio"] {
      display: none;
    }

    /* TABS LABEL STYLES*/
    .tabs label {
      padding: var(--padding-input);
      cursor: pointer;
      background-color: var(--tab-inactive-color);
      border-bottom: var(--input-hover-color) 2px solid;
      color: var(--tab-text-color);
      text-align: center;
      border-radius: var(--border-radius) var(--border-radius) 0 0;
      flex: 1;
      margin-right: 0.5rem;
      display: inline-block;
      width: 50%;
    }

    /* TABS LABEL LAST STYLE*/
    .tabs label:last-of-type {
      margin-right: 0;
    }

    /* TABS LABEL SELECTED STYLE*/
    .tabs input[type="radio"]:checked + label {
      background-color: var(--background-primary-opacity);
      border-bottom: var(--background-primary) 2px solid;
    }

    /* TABS CONTENT STYLES*/
    .contenttab {
      width: 100%;
      height: 100%;
      
    }

    /* TABS CONTENT DISPLAY STYLES*/
    .tab-content {
      display: none;
      padding: var(--padding);
      background-color: var(--background-color-input-section);
      border-radius: 0 var(--border-radius) var(--border-radius) var(--border-radius);
      margin-top: var(--padding);
      
      
    }

    /* #tab1:checked ~ .tab-content#content1,
    #tab2:checked ~ .tab-content#content2 {
      display: block;
      background-color: yellow;
      
    } */

    /* TABS DISPLAY*/
    #tab1:checked ~ .contenttab #content1,#tab2:checked ~ .contenttab #content2 {
      display: none; /* Ensure default state is hidden */
    }
    #tab1:checked ~ .contenttab #content1 {
      display: block;
    }
    #tab2:checked ~ .contenttab #content2 {
      display: block;
    }

    /* COLOUR FONT PICKER STYLES*/
    .color-picker, .font-picker {
      margin-top: var(--padding);
      display: flex;
      /* width: 200px; */
      align-items: center;
      justify-content: center;
      gap : var(--padding);
    }
    .color-picker label {
      display: inline-block;
      margin-bottom: 0.5rem;
    }

    /* LOADING SCREEN STYLES*/
    #loading-screen {
      display: none; /* Hidden by default */
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    /* SPINNER STYLES*/
    #loading-screen .spinner {
      border: 16px solid #f3f3f3; /* Light grey */
      border-top: 16px solid #3498db; /* Blue */
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 4s linear infinite;
    }

    /* SPINNER ANIMATION*/
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

  </style>
</head>

<body>
  <div class="container">
    <h1>CoGen</h1>

    <!-- TOP CONTAINER FOR INPUT FIELD-->
    <div class="sections-horizontal">
      <!-- input field-->
      <input type="text" id="prompt" placeholder="Describe your design">
      <!-- generate button-->
      <button id="generate" class="generate-button">Generate</button>
    </div>

    <!-- BOTTOM CONTAINER FOR COLOUR AND FONT SELECTION-->
    <div class="sections-vertical">
      <!-- Add tabs for color and font selection -->
      <div class="tabs">
        <input type="radio" id="tab1" name="tab" checked>
        <label for="tab1">Colours</label>
        <input type="radio" id="tab2" name="tab">
        <label for="tab2">Font</label>
      </div>

      <!-- CONTENT FOR FONT AND COLOUR -->
      <div class="contenttab">

        <!-- FONT SELECTION TAB CONTENT-->
        <div class="tab-content" id="content1">
          
          <div class="color-picker">
            <!-- BACKGROUND COLOUR -->
            <label for="color">Background colour:</label>
            <input type="color" id="color" name="color" value="#ffffff">

            <!-- FONT COLOUR -->
            <label for="fontColor">Font colour:</label> 
            <input type="color" id="fontColor" name="fontColor" value="#000000"> <!-- Added line -->
          </div>
        </div>
      
        <!-- FONT SELECTION TAB CONTENT-->
        <div class="tab-content" id="content2">
          
          <div class="font-picker">
            <!-- FONT FAMILY -->
            <label for="font-family">Font family:</label>
            <select id="font-family" name="font-family">
              <!-- this is for family -->
            </select>

            <!-- FONT SIZE -->
            <label for="font-size">Font size:</label>
            <input type="number" id="font-size" name="font-size" min="12" max="36" value="16">
            
            <!-- FONT WEIGHT -->
            <label for="font-weight">Font weight:</label>
            <select id="font-weight" name="font-weight">
              <!-- this is for weight -->
            </select>
          </div>
        </div>
      </div>
      </div>
      </div>
    </div>
  </div>
 
  <script>
    // Generate button
    document.getElementById('generate').addEventListener('click', async () => {
      
      // Show loading screen
      document.getElementById('loading-screen').style.display = 'flex';

      //prompt value
      const prompt = document.getElementById('prompt').value;
      // colour value
      const color = document.getElementById('color').value;
      //font colour
      const fontColor = document.getElementById('fontColor').value;
      //font family
      const fontFamily = document.getElementById('font-family').value;
      //font weight
      const fontWeight = document.getElementById('font-weight').value;
      
      console.log('Prompt:', prompt, 'Color:', color, 'Font colour:', fontColor, 'Font family:', fontFamily, 'Font weight:', fontWeight);

      try {
        //USE NGROK URL!!!!
        const response = await fetch('https://fc59-203-143-16-65.ngrok-free.app/generate', { 
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ prompt,color,fontColor,fontFamily,fontWeight })
        });

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const figmaJson = await response.json();
        console.log('Figma JSON:', figmaJson);
        //sending the json from frontend to the plugin
        parent.postMessage({ pluginMessage: { type: 'create-component', data: figmaJson } }, '*');

        
        alert('Successfully generated a component');
      } catch (error) {
        console.error('Error:', error);
        alert('Fetch failed!');
      }finally{
        document.getElementById('loading-screen').style.display = 'none';}
    });

    
    //fonts
    window.onmessage = async (event) => {
    if (event.data.pluginMessage.type === 'fonts') {
      const fonts = event.data.pluginMessage.fonts;
      //family
      const fontFamilySelect = document.getElementById('font-family');
      //weight
      const fontWeightSelect = document.getElementById('font-weight');


      //load fonts from Figma
      const fontFamilies = {};
      fonts.forEach(font => {
        if (!fontFamilies[font.fontName.family]) {
          fontFamilies[font.fontName.family] = new Set();
        }
        fontFamilies[font.fontName.family].add(font.fontName.style);
      });

      for (const family in fontFamilies) {
        const option = document.createElement('option');
        option.value = family;
        option.text = family;
        fontFamilySelect.appendChild(option);
      }

      fontFamilySelect.addEventListener('change', (event) => {
        const selectedFamily = event.target.value;
        fontWeightSelect.innerHTML = '';

        fontFamilies[selectedFamily].forEach(style => {
          const option = document.createElement('option');
          option.value = style;
          option.text = style;
          fontWeightSelect.appendChild(option);
        });
      });

      
      fontFamilySelect.dispatchEvent(new Event('change'));
    }
  };



    //tabs
    document.querySelectorAll('.tabs input[type="radio"]').forEach((tab) => {
      tab.addEventListener('change', (event) => {
        document.querySelectorAll('.tab-content').forEach((content) => {
          content.style.display = 'none';
        });
        document.querySelector(`#content${event.target.id.slice(-1)}`).style.display = 'block';
      });
    });


    document.querySelector('.tabs input[type="radio"]:checked').dispatchEvent(new Event('change'));
  
  </script>
  <!--LOADING SCREEN ANIMATION-->
  <div id="loading-screen">
    <div class="spinner"></div>
  </div>
</body>

</html>
